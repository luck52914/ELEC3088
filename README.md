# ELEC3088
 ELEC3088   operating system , add me wechat velpro6996
​​ELEC ENG 3088/7088 Computer ArchitectureAssignment—RISC-V RV64I ISS—Stage 2Your task for this assignment is to extend your RV64I ISS from Stage 1 with:•The Zicsrinstruction set extension defined in Chapter 9 ofTheRISC-V Instruction Set Manual,Volume I: UnprivilegedISA.•AsubsetoftheRISC-Vprivilegedarchitectureforhandlingexceptionsandinterrupts.TheRISC-Vprivileged architectureisdescribedinTheRISC-VInstructionSetManual,VolumeII:PrivilegedArchitecture,available on the course website.TheRISC-Vprivilegedarchitecturespecificationdefinesthreeprivilegelevelsforexecutionofinstructions:user,supervisor,andmachinemodes.Forthisassignmentyoushouldimplementfeaturesdefinedforusermodeandmachine mode, but not for supervisor mode. The specification also defines some features fordebug mode, which you should also notimplement.You should implement the following machine-mode control and status registers (CSRs), listed in Table 2.4anddescribed in Section3.1:NumberPrivilegeNameDescription0xF11MROmvendoridVendor ID. Fixed value of 0 to indicate non-commercial implementation.0xF12MROmarchidArchitecture ID. Fixed value of 0 to indicated no ID implemented.0xF13MROmimpidImplementation ID. Fixed value of 0x20yy020000000000 to indicate animplementation in year 20yy, Stage 2(yy represents the last 2 digits ofthe year).0xF14MROmhartidHardware thread ID. Fixed value of 0, since this is the only hart in thesimulated processor.0x300MRWmstatusMachine status register, formatted as shown in Figure 3.7. Only thefollowing bits are implemented: mie, mpie, mpp. Other bits are fixed at0, except for uxl fixed at2.0x301MRWmisaISA and extensions register. Fixed value of 0x8000000000100100 (MXL =2 for 64-bit XLEN, I and U bits set in Extensions field). While csrinstructions can legally write to this CSR, the CSR value remains fixed.0x304MRWmieMachine interrupt enable register. Only the following bits areimplemented: usie, msie, utie, mtie, ueie, meie. Other bits are fixed at 0.0x305MRWmtvecMachine trap handler base address register. The MODE field can only be0or1,sobit1ofmtvecisfixedat0.IfMODEis1(Vectored),then BASEmustbe256-bytealigned;inthatcase,mtvecbits2to7arefixed at0.0x340MRWmscratchScratch register for machine trap handlers.0x341MRWmepcMachine exception program counter. Bits 0 and 1 are fixed at 0.0x342MRWmcauseMachine trap cause. Only Interrupt bit and 4-bit Exception code fieldimplemented. Other bits are fixed at 0.0x343MRWmtvalMachine bad address or instruction. For misaligned address exceptions,mtval is written with the address. For illegal instruction exceptions, theleast-significant word of mtval is written with the instruction word, andthe most-significant word of mtval is set to 0. For other exceptions,mtval is set to 0.
2NumberPrivilegeNameDescription0x344MRWmipMachine interrupt pending. Only the following bits are implemented:usip, msip, utip, mtip, ueip, meip. Other bits are fixed at 0.We will provide an extended command handler that implements the following commands, in addition tothose pro-vided for Stage 1:CommandOperation performedcsrnumShowthecontentofCSRnum(numinhex).Thevalueisdisplayedas16hexdigitswithleading0s.csrnum=valueSet CSRnumtovalue(numandvaluein hex).prvDisplay the current processor privilege level (0 = user, or 3 = machine)prv =valueSet the current processor privilege level tovalue(0 = user, or 3 = machine)You should implement the following Zicsr extension instructions:•csrrw, csrrs, csrrc, csrrwi, csrrsi,csrrciYou should also implement the following privileged instructions defined in Section 3.2:•ecall: environment call from user mode or from machinemode•ebreak: breakpoint•Note that this is different from,and additional to,the b command breakpoint from Stage1•mret: return from machinetrapYou should extend the way your simulated processor executes instructions to check for the exceptions inthe table below. If an exception occurs during execution of an instruction, the instruction is not retired, so itis not included in the count of executed instructions.Cause codeExceptionInstructions that cause exception0Instruction address misalignedAny instruction fetch for which the PC is not a multiple of 4.2Illegal instructionAny defined instruction that is not implemented. Any undefinedinstruction.An mret instruction executed in user mode.A csrinstruction (not the csr command) that accesses anundefined or unimplemented CSR.3Breakpointebreak4Load address misalignedld for which the effective address is not a multiple of 8. lw/lwufor which the effective address is not a multiple of 4. lh/lhu orwhich the effective address is not a multiple of 2.6Store address misalignedsdfor which the effective address is not a multiple of 8. sw forwhich the effective address is not a multiple of4. sh or which theeffective address is not a multiple of2.8Environment call from U-modeecall executed in user mode.11Environment call from M-modeecall executed in machine mode.You should also implement the following interrupts:
